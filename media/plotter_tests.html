<html>
 <head>
  <title>Test Page for plotter.js</title>
  <script language="javascript" src="jsunit/app/jsUnitCore.js"></script>
  <script language="javascript" src="js/taffy.js"></script>
  <script language="javascript" src="js/jquery/jquery.js"></script>
  <script language="javascript" src="js/plotter.js"></script>
 </head>
 <body>
  <script language="javascript">

    function testQueryValidation(){
        // tests if validation of a query-object with _validate_query works
        // test correct
        query = {country : 'de', zip : '53111', date : '2008-11-21'};
        assertTrue('Correct Query', PLTR.dates._validate_query(query));

        query.zip = '50';
        assertTrue('Correct Query - short zip', PLTR.dates._validate_query(query));
        query.zip = [12345,54321];
        assertTrue('Correct Query - zip-array', PLTR.dates._validate_query(query));
 
        // test wrong
        query.date = 'derm';
        assertFalse('Defect Date', PLTR.dates._validate_query(query));

        query.date = '2008-12-12';
        query.zip = 'derm' 
        assertFalse('Defect Zip', PLTR.dates._validate_query(query));
        query.zip = [] 
        assertFalse('Defect Zip - empty array', PLTR.dates._validate_query(query));



        //TODO
        // testcase is incomplete. other defect queries should be tested
    }

    function testUrlBuildingFromQuery(){
        // tests if construction of a url from a query object works
        query = { country : 'de', zip : '53111', date : '2008-11-21' };
        url = PLTR.dates._query_url(query);
        assertEquals('/dates/2008-11-21/de/53111/', url);

        query = { country : 'de', zip : [53111, 50672], date : '2008' };
        url = PLTR.dates._query_url(query);
        assertEquals('/dates/2008/de/53111,50672/', url);



    }

    function testTemplate(){ 
        // tests the mini-template engine of plotter
        var template = 'My name is {{ name }}.';
        var context = { name : 'Harold' }; 
        assertEquals('My name is Harold.', PLTR.template.render(template, context));
        
    }

    function testInfobar() {
        var msg = 'testing infobar';
        PLTR.infobar.message(msg);
        assertEquals('Infobar should contain message-text', 
           msg, $(PLTR.conf.selectors.infobar_msg).text() );

    }

    function testLog() {
       PLTR.log('test'); 
       // i dont think this is testable. just wanna execte it in case 
       // of typo. does jsunit require an assertion in a test-func?
    }
  </script>
<!-- -->
   <div id="header">
      <h1>PLOTTR</h1>
   </div>
   <div id="navi"></div>
   <div id="infobar"></div>
   <div id="content">
      <div id="primary"></div>
      <div id="secondary"></div>
   </div>
 </body>
</html>
